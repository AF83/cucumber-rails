Feature: Manage <%= plural_name %>
  In order to [goal]
  [stakeholder]
  wants [behaviour]
  
  Scenario: Register new <%= singular_name %>
    Given I am on the new <%= singular_name %> page
<% keyword = 'When' -%>
<% named_args.each do |arg| -%>
  <% if arg.type == 'boolean' -%>
  <%= keyword %> I uncheck "<%= arg.name.humanize %>"
  <% else -%>
  <%= keyword %> I fill in "<%= arg.name.humanize %>" with "<%= arg.value(1) %>"
  <% end -%>
<% keyword = 'And' -%>
<% end -%>
    And I press "Create"
<% keyword = 'Then' -%>
<% named_args.each do |arg| -%>
    <%= keyword %> I should see "<%= arg.value(1) %>"
<% keyword = 'And' -%>
<% end -%>

<% if File.file?('features/support/capybara.rb') -%>
  # Rails generates delete links that use Javascript to do a HTTP
  # POST request (emulated DELETE request). Capybara must use Culerity
  # for such scenarios and turn off transactions. Turning off transactions
  # for just one scenario (and keeping them on for the rest of the scenarios)
  # will leave data in the database for following scenarios, which will
  # inevitably cause unpredictable results.
  #
  # It is therefore recommended that you do one of the following:
  #
  # a) Keep those tags, but add an After('@no-txn') that cleans the DB with DatabaseCleaner
  # b) Keep those tags, but globally turn off transactions in features/support/capybara.rb and 
  #    add Before('@no-txn') that cleans the DB with DatabaseCleaner
  # c) Remove those tags and modify your views to use <button> instead: http://github.com/jnicklas/capybara/issues#issue/12
  @culerity @no-txn
<% end -%>
  Scenario: Delete <%= singular_name %>
    Given the following <%= plural_name %>:
      |<%= named_args.map(&:name).join('|') %>|
<% (1..4).each do |n| -%>
      |<%= named_args.map{|arg| arg.value(n)}.join('|') %>|
<% end -%>
    When I delete the 3rd <%= singular_name %>
    Then I should see the following <%= plural_name %>:
      |<%= named_args.map{|arg| arg.name.humanize}.join('|') %>|
<% [1,2,4].each do |n| -%>
      |<%= named_args.map{|arg| arg.value(n)}.join('|') %>|
<% end -%>
